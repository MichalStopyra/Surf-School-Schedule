{"ast":null,"code":"import _defineProperty from\"/home/michal/Desktop/projekty/java/SurfSchoolSchedule/SurfSchoolSchedule/surf-school-schedule/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/michal/Desktop/projekty/java/SurfSchoolSchedule/SurfSchoolSchedule/surf-school-schedule/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/michal/Desktop/projekty/java/SurfSchoolSchedule/SurfSchoolSchedule/surf-school-schedule/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/michal/Desktop/projekty/java/SurfSchoolSchedule/SurfSchoolSchedule/surf-school-schedule/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/michal/Desktop/projekty/java/SurfSchoolSchedule/SurfSchoolSchedule/surf-school-schedule/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import axios from'axios';import{Link}from'react-router-dom';import{Card,Table,ButtonGroup,Button,InputGroup,FormControl,Form,Col}from'react-bootstrap';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faWallet,faMoneyCheckAlt,faUndo,faArrowLeft,faList}from'@fortawesome/free-solid-svg-icons';import SuccessToast from'../SuccessToast';import StudentLessonsList from'./StudentLessonsList';import{connect}from'react-redux';import{deleteLesson as _deleteLesson,fetchAllLessonsForStudent as _fetchAllLessonsForStudent,searchLessons as _searchLessons,updateLesson as _updateLesson,fetchStudent as _fetchStudent,fetchAllPriceTables as _fetchAllPriceTables,fetchPriceTableWithNrOfLessons as _fetchPriceTableWithNrOfLessons,updateStudent as _updateStudent}from'./../../services/index';import'./../../style/Style.css';var StudentSettle=/*#__PURE__*/function(_React$Component){_inherits(StudentSettle,_React$Component);var _super=_createSuper(StudentSettle);function StudentSettle(props){var _this;_classCallCheck(this,StudentSettle);_this=_super.call(this,props);_this.countTotalPrice=function(){var tempTotalPrice=_this.state.priceOneH[0]*_this.state.howMany1p;tempTotalPrice+=_this.state.priceOneH[1]*_this.state.howMany2p;tempTotalPrice+=_this.state.priceOneH[2]*_this.state.howMany3p;tempTotalPrice=tempTotalPrice*(100-_this.state.discount)/100;if(_this.props.student.student.moneyInAdvance)tempTotalPrice-=_this.props.student.student.moneyInAdvance;_this.setState({totalPrice:tempTotalPrice});};_this.countLessons=function(){var lessons=_this.props.lessons;lessons=lessons.filter(function(lesson){return lesson.status===\"Finished_Unpaid\";});var count1p=0;var count2p=0;var count3p=0;for(var i=0;i<lessons.length;++i){switch(lessons[i].nrStudents){case 1:count1p+=lessons[i].howLong;break;case 2:count2p+=lessons[i].howLong;break;default:count3p+=lessons[i].howLong;break;}_this.setState({howMany1p:count1p,howMany2p:count2p,howMany3p:count3p});}};_this.findAllPriceTables=function(){var fullNrOfLessons=_this.props.student.student.lessonHours;_this.props.fetchPriceTableWithNrOfLessons(fullNrOfLessons);setTimeout(function(){_this.props.fetchAllPriceTables(_this.props.priceTable.priceTable);},100);setTimeout(function(){_this.setState({priceTable:_this.props.priceTable.priceTable});_this.setPriceOneH();},100);};_this.setPriceOneH=function(){// let priceOneHTab = [this.props.priceTable.priceTable.onePPrice, this.props.priceTable.priceTable.twoPPrice, this.props.priceTable.priceTable.threePPrice]\nvar priceOneHTab;if(_this.state.customPrice){priceOneHTab=[_this.state.customPrice,_this.state.customPrice,_this.state.customPrice];}else{var tempPriceTab;if(typeof _this.state.priceTable!=='object')tempPriceTab=JSON.parse(_this.state.priceTable);else tempPriceTab=_this.state.priceTable;priceOneHTab=[tempPriceTab.onePPrice,tempPriceTab.twoPPrice,tempPriceTab.threePPrice];}_this.setState({priceOneH:priceOneHTab});};_this.findStudentById=function(idStudent){_this.props.fetchStudent(idStudent);setTimeout(function(){var student=_this.props.student.student;if(student!=null){_this.setState({student:student// id: student.id,\n// lastName: student.lastName,\n// firstName: student.firstName,\n// idCardNr: student.idCardNr,\n// telNr: student.telNr,\n// paymentStatus: student.paymentStatus,\n// lessonHours: student.lessonHours,\n// unpaidLessons: student.unpaidLessons,\n// moneyOwing: student.moneyOwing,\n// moneyInAdvance: student.moneyInAdvance\n});}},1000);};_this.settleChange=function(event){_this.setState(_defineProperty({},event.target.name,event.target.value));_this.setPriceOneH();setTimeout(function(){_this.setPriceOneH();_this.countTotalPrice();},100);};_this.handleCheckboxCustomPriceChange=function(){_this.setState({disableCustomPrice:!_this.state.disableCustomPrice,customPrice:''});setTimeout(function(){if(_this.state.disableCustomPrice){_this.setPriceOneH();_this.countTotalPrice();}},10);};_this.handleCheckboxDiscountChange=function(){_this.setState({disableDiscount:!_this.state.disableDiscount,discount:''});setTimeout(function(){if(_this.state.disableDiscount){_this.setPriceOneH();_this.countTotalPrice();}},10);};_this.returnToStudentList=function(){return _this.props.history.push(\"/students\");};_this.settleStudent=function(){var studentLessons=_this.props.lessons;for(var i=0;i<studentLessons.length;++i){if(studentLessons[i].status==='Finished_Unpaid'){var lesson={id:studentLessons[i].id,instructor:studentLessons[i].instructor,student:studentLessons[i].student,date:studentLessons[i].date,time:studentLessons[i].time,howLong:studentLessons[i].howLong,nrStudents:studentLessons[i].nrStudents,status:\"Finished_Paid\"};//  console.log(lesson);\n_this.props.updateLesson(lesson);}}if(_this.state.totalPrice<0){var newMoneyInAdvance=-_this.state.totalPrice;var newPaymentStatus=\"We_Owe\";}//let newStudentStatus = \"We_Owe\"\n// Owes_Us\nelse{var newMoneyInAdvance=0;var newPaymentStatus=\"Settled\";}var student={id:_this.props.student.student.id,lastName:_this.props.student.student.lastName,firstName:_this.props.student.student.firstName,idCardNr:_this.props.student.student.idCardNr,telNr:_this.props.student.student.telNr,paymentStatus:newPaymentStatus,lessonHours:_this.props.student.student.lessonHours,unpaidLessons:_this.props.student.student.unpaidLessons,moneyOwing:_this.props.student.student.moneyOwing,moneyInAdvance:newMoneyInAdvance};// console.log(student);\n_this.props.updateStudent(student);setTimeout(function(){if(!_this.props.student.error&&!_this.props.lesson.error){_this.setState({\"showSuccesMessage\":true});setTimeout(function(){return _this.setState({\"showSuccessMessage\":false});},3000);setTimeout(function(){return _this.returnToStudentList();},1000);}else{_this.setState({\"showInvalidMessage\":true,\"method\":\"post\"});setTimeout(function(){return _this.setState({\"showInvalidMessage\":false});},3000);}},2000);};_this.listButtonHandle=function(){_this.setState({showLessonList:!_this.state.showLessonList});};_this.state={idStudent:+_this.props.match.params.id,student:'',lessons:[],priceTable:'',priceOneH:[],customPrice:'',discount:'',totalPrice:'',howMany1p:'',howMany2p:'',howMany3p:'',currentPage:1,lessonsPerPage:20,searchedLesson:'',sortToggle:false,disableCustomPrice:true,disableDiscount:true,showSuccessMessage:false,showLessonList:false};return _this;}_createClass(StudentSettle,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.findStudentById(this.state.idStudent);this.props.fetchAllLessonsForStudent(+this.props.match.params.id,1,this.state.lessonsPerPage);setTimeout(function(){_this2.findAllPriceTables();_this2.countLessons();setTimeout(function(){_this2.countTotalPrice();},100);},1000);}},{key:\"render\",value:function render(){var _this3=this;var searchedLesson=this.props.lesson.searchedLesson;var totalPages=this.props.lesson.totalPages;var totalElements=this.props.lesson.totalElements;var lesson=this.props.lesson;var lessons=this.props.lessons;var currentPage=this.props.lesson.currentPage;var student=this.props.student.student;var _this$props$student$s=this.props.student.student,moneyInAdvance=_this$props$student$s.moneyInAdvance,unpaidLessons=_this$props$student$s.unpaidLessons,paymentStatus=_this$props$student$s.paymentStatus,lessonHours=_this$props$student$s.lessonHours;var priceTables=this.props.priceTable.priceTables;var _this$state=this.state,priceTable=_this$state.priceTable,priceOneH=_this$state.priceOneH,discount=_this$state.discount,totalPrice=_this$state.totalPrice,payForHowMany=_this$state.payForHowMany,howMany1p=_this$state.howMany1p,howMany2p=_this$state.howMany2p,howMany3p=_this$state.howMany3p,customPrice=_this$state.customPrice;var pageNumCss={width:\"45px\",border:\"1px solid #F8F8FF\",color:\"#F8F8FF\",textAlign:\"center\",fontWeight:\"bold\"};var searchBoxCss={width:\"100px\",border:\"1px solid #17A2B8\",color:\"#17A2B8\",textAlign:\"center\",fontWeight:\"bold\"};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{style:{\"display\":this.state.show?\"block\":\"none\"}},/*#__PURE__*/React.createElement(SuccessToast,{show:this.state.show,message:\"Student Settled Successfully\",type:\"success\"})),/*#__PURE__*/React.createElement(StudentLessonsList,{showLessonList:this.state.showLessonList,student:student,lessons:lessons,onClose:this.listButtonHandle}),/*#__PURE__*/React.createElement(Card,{className:\"border border-dark bg-dark text-white\"},/*#__PURE__*/React.createElement(Card.Header,null,/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faWallet}),\" Settle Student\"),/*#__PURE__*/React.createElement(Form,null,/*#__PURE__*/React.createElement(Card.Body,null,/*#__PURE__*/React.createElement(\"div\",{id:\"container\",style:{\"clear\":\"both\",\"display\":\"flex\",\"justifyContent\":\"space-between\"}},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h5\",null,\"Student\"),/*#__PURE__*/React.createElement(\"h4\",null,student.firstName+\" \"+student.lastName),/*#__PURE__*/React.createElement(\"h6\",null,\"Full Nr of Lessons [h]\"),/*#__PURE__*/React.createElement(\"h5\",null,lessonHours),/*#__PURE__*/React.createElement(\"h6\",null,\"Nr of Unpaid Lessons [h] (1p/2p/+3p)\"),/*#__PURE__*/React.createElement(\"h5\",null,unpaidLessons,\" (\",howMany1p?howMany1p:0,\"/\",howMany2p?howMany2p:0,\"/\",howMany3p?howMany3p:0,\")\"),/*#__PURE__*/React.createElement(\"h6\",null,\"Money in advance [zl]\"),/*#__PURE__*/React.createElement(\"h5\",null,moneyInAdvance),/*#__PURE__*/React.createElement(\"h5\",null,\"Total price\"),/*#__PURE__*/React.createElement(\"h4\",null,totalPrice?totalPrice:0,\" zl\")),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Form.Group,{as:Col,controlId:\"formGridPriceTables\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Offer\"),/*#__PURE__*/React.createElement(Form.Control,{disabled:!this.state.disableCustomPrice,required:true,as:\"select\",autoComplete:\"off\",name:\"priceTable\",value:priceTable,onChange:this.settleChange,className:\"bg-dark text-white\"},this.state.disableCustomPrice?priceTables.map(function(priceTable){return/*#__PURE__*/React.createElement(\"option\",{key:priceTable.id,value:JSON.stringify(priceTable)},priceTable.name+\" \"+priceTable.minNrHours+\"h\");}):\"\")),/*#__PURE__*/React.createElement(InputGroup,{className:\"mb-3\"},/*#__PURE__*/React.createElement(InputGroup.Prepend,null,/*#__PURE__*/React.createElement(InputGroup.Checkbox,{onChange:function onChange(){return _this3.handleCheckboxCustomPriceChange();}})),/*#__PURE__*/React.createElement(Form.Group,{as:Col,controlId:\"formGridCustomPrice\",name:\"customPrice\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Custom Price\"),/*#__PURE__*/React.createElement(Form.Control,{disabled:this.state.disableCustomPrice,autoComplete:\"off\",type:\"test\",name:\"customPrice\",value:customPrice,onChange:this.settleChange,placeholder:this.state.disableCustomPrice?\"\":\"Enter Price [zl]\",className:\"bg-dark text-white\"}))),/*#__PURE__*/React.createElement(InputGroup,{className:\"mb-3\"},/*#__PURE__*/React.createElement(InputGroup.Prepend,null,/*#__PURE__*/React.createElement(InputGroup.Checkbox,{onChange:function onChange(){return _this3.handleCheckboxDiscountChange();}})),/*#__PURE__*/React.createElement(Form.Group,{as:Col,controlId:\"formGridDiscount\",name:\"discount\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Discount [%]\"),/*#__PURE__*/React.createElement(Form.Control,{disabled:this.state.disableDiscount,autoComplete:\"off\",type:\"test\",name:\"discount\",value:discount,onChange:this.settleChange,placeholder:this.state.disableDiscount?\"\":\"Enter Discount [%]\",className:\"bg-dark text-white\"})))))),/*#__PURE__*/React.createElement(Card.Footer,null,/*#__PURE__*/React.createElement(\"div\",{id:\"container\",style:{\"clear\":\"both\",\"display\":\"flex\",\"justifyContent\":\"space-between\"}},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{size:\"sm\",variant:\"info\",onClick:function onClick(){return _this3.settleStudent();}},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faMoneyCheckAlt}),\"  Settle\"),'      ',/*#__PURE__*/React.createElement(Button,{size:\"sm\",variant:\"secondary\",type:\"reset\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faUndo}),\"  Reset\")),/*#__PURE__*/React.createElement(Button,{size:\"bg\",variant:\"light\",disabled:lessons.filter(function(lesson){return lesson.status==\"Finished_Unpaid\";}).length?false:true,onClick:function onClick(){return _this3.listButtonHandle();}},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faList}),\"  Unpaid Lessons\")),'      ',/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{size:\"sm\",variant:\"light\",type:\"button\",onClick:function onClick(){return _this3.returnToStudentList();}},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faArrowLeft}),\"  Return\"))))));}}]);return StudentSettle;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{lessons:state.lesson.lessons,lesson:state.lesson.lesson,student:state.student,priceTable:state.priceTable};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{fetchAllLessonsForStudent:function fetchAllLessonsForStudent(studentId,currentPage,size){return dispatch(_fetchAllLessonsForStudent(studentId,currentPage,size));},deleteLesson:function deleteLesson(lessonId){return dispatch(_deleteLesson(lessonId));},searchLessons:function searchLessons(searchedLesson,currentPage,sizePage){return dispatch(_searchLessons(searchedLesson,currentPage,sizePage));},updateLesson:function updateLesson(lesson){return dispatch(_updateLesson(lesson));},fetchStudent:function fetchStudent(studentId){return dispatch(_fetchStudent(studentId));},fetchAllPriceTables:function fetchAllPriceTables(firstElement){return dispatch(_fetchAllPriceTables(firstElement));},fetchPriceTableWithNrOfLessons:function fetchPriceTableWithNrOfLessons(fullNrOfLessons){return dispatch(_fetchPriceTableWithNrOfLessons(fullNrOfLessons));},updateStudent:function updateStudent(student){return dispatch(_updateStudent(student));}};};export default connect(mapStateToProps,mapDispatchToProps)(StudentSettle);","map":{"version":3,"sources":["/home/michal/Desktop/projekty/java/SurfSchoolSchedule/SurfSchoolSchedule/surf-school-schedule/src/components/Student/StudentSettle.js"],"names":["React","axios","Link","Card","Table","ButtonGroup","Button","InputGroup","FormControl","Form","Col","FontAwesomeIcon","faWallet","faMoneyCheckAlt","faUndo","faArrowLeft","faList","SuccessToast","StudentLessonsList","connect","deleteLesson","fetchAllLessonsForStudent","searchLessons","updateLesson","fetchStudent","fetchAllPriceTables","fetchPriceTableWithNrOfLessons","updateStudent","StudentSettle","props","countTotalPrice","tempTotalPrice","state","priceOneH","howMany1p","howMany2p","howMany3p","discount","student","moneyInAdvance","setState","totalPrice","countLessons","lessons","filter","lesson","status","count1p","count2p","count3p","i","length","nrStudents","howLong","findAllPriceTables","fullNrOfLessons","lessonHours","setTimeout","priceTable","setPriceOneH","priceOneHTab","customPrice","tempPriceTab","JSON","parse","onePPrice","twoPPrice","threePPrice","findStudentById","idStudent","settleChange","event","target","name","value","handleCheckboxCustomPriceChange","disableCustomPrice","handleCheckboxDiscountChange","disableDiscount","returnToStudentList","history","push","settleStudent","studentLessons","id","instructor","date","time","newMoneyInAdvance","newPaymentStatus","lastName","firstName","idCardNr","telNr","paymentStatus","unpaidLessons","moneyOwing","error","listButtonHandle","showLessonList","match","params","currentPage","lessonsPerPage","searchedLesson","sortToggle","showSuccessMessage","totalPages","totalElements","priceTables","payForHowMany","pageNumCss","width","border","color","textAlign","fontWeight","searchBoxCss","show","map","stringify","minNrHours","Component","mapStateToProps","mapDispatchToProps","dispatch","studentId","size","lessonId","sizePage","firstElement"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport axios from 'axios';\nimport { Link } from 'react-router-dom';\nimport { Card, Table, ButtonGroup, Button, InputGroup, FormControl, Form, Col } from 'react-bootstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faWallet, faMoneyCheckAlt, faUndo, faArrowLeft, faList } from '@fortawesome/free-solid-svg-icons';\nimport SuccessToast from '../SuccessToast';\nimport StudentLessonsList from './StudentLessonsList';\nimport { connect } from 'react-redux';\nimport {\n    deleteLesson, fetchAllLessonsForStudent, searchLessons, updateLesson,\n    fetchStudent, fetchAllPriceTables, fetchPriceTableWithNrOfLessons, updateStudent\n} from './../../services/index';\n\nimport './../../style/Style.css';\n\n\nclass StudentSettle extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            idStudent: +this.props.match.params.id,\n            student: '',\n            lessons: [],\n            priceTable: '',\n            priceOneH: [],\n            customPrice: '',\n            discount: '',\n            totalPrice: '',\n            howMany1p: '',\n            howMany2p: '',\n            howMany3p: '',\n            currentPage: 1,\n            lessonsPerPage: 20,\n            searchedLesson: '',\n            sortToggle: false,\n            disableCustomPrice: true,\n            disableDiscount: true,\n            showSuccessMessage: false,\n            showLessonList: false\n        };\n    }\n\n    componentDidMount() {\n        this.findStudentById(this.state.idStudent);\n        this.props.fetchAllLessonsForStudent(+this.props.match.params.id, 1, this.state.lessonsPerPage);\n        setTimeout(() => {\n            this.findAllPriceTables();\n            this.countLessons();\n            setTimeout(() => { this.countTotalPrice() }, 100);\n        }, 1000);\n\n    }\n\n    countTotalPrice = () => {\n        let tempTotalPrice = this.state.priceOneH[0] * this.state.howMany1p;\n        tempTotalPrice += this.state.priceOneH[1] * this.state.howMany2p;\n        tempTotalPrice += this.state.priceOneH[2] * this.state.howMany3p;\n        tempTotalPrice = tempTotalPrice * (100 - this.state.discount) / 100\n        if (this.props.student.student.moneyInAdvance)\n            tempTotalPrice -= this.props.student.student.moneyInAdvance;\n        this.setState({\n            totalPrice: tempTotalPrice\n        });\n\n    }\n\n    countLessons = () => {\n        let lessons = this.props.lessons;\n\n        lessons = lessons.filter(lesson => lesson.status === \"Finished_Unpaid\");\n        let count1p = 0;\n        let count2p = 0;\n        let count3p = 0;\n        for (let i = 0; i < lessons.length; ++i) {\n            switch (lessons[i].nrStudents) {\n                case 1:\n                    count1p += lessons[i].howLong;\n                    break;\n                case 2:\n                    count2p += lessons[i].howLong;\n                    break;\n                default:\n                    count3p += lessons[i].howLong;\n                    break;\n            }\n            this.setState({\n                howMany1p: count1p,\n                howMany2p: count2p,\n                howMany3p: count3p\n            });\n        }\n    }\n\n\n    findAllPriceTables = () => {\n        let fullNrOfLessons = this.props.student.student.lessonHours;\n        this.props.fetchPriceTableWithNrOfLessons(fullNrOfLessons);\n        setTimeout(() => {\n            this.props.fetchAllPriceTables(this.props.priceTable.priceTable);\n        }, 100);\n        setTimeout(() => {\n            this.setState({\n                priceTable: this.props.priceTable.priceTable\n            });\n            this.setPriceOneH();\n        }, 100);\n\n    }\n\n    setPriceOneH = () => {\n        // let priceOneHTab = [this.props.priceTable.priceTable.onePPrice, this.props.priceTable.priceTable.twoPPrice, this.props.priceTable.priceTable.threePPrice]\n        let priceOneHTab;\n        if (this.state.customPrice) {\n            priceOneHTab = [this.state.customPrice, this.state.customPrice, this.state.customPrice]\n        }\n        else {\n            let tempPriceTab;\n            if (typeof (this.state.priceTable) !== 'object')\n                tempPriceTab = JSON.parse(this.state.priceTable);\n            else\n                tempPriceTab = this.state.priceTable;\n            priceOneHTab = [tempPriceTab.onePPrice, tempPriceTab.twoPPrice, tempPriceTab.threePPrice]\n        }\n        this.setState({ priceOneH: priceOneHTab })\n    }\n\n    findStudentById = (idStudent) => {\n\n        this.props.fetchStudent(idStudent);\n        setTimeout(() => {\n\n            let student = this.props.student.student;\n            if (student != null) {\n                this.setState({\n                    student: student\n                    // id: student.id,\n                    // lastName: student.lastName,\n                    // firstName: student.firstName,\n                    // idCardNr: student.idCardNr,\n                    // telNr: student.telNr,\n                    // paymentStatus: student.paymentStatus,\n                    // lessonHours: student.lessonHours,\n                    // unpaidLessons: student.unpaidLessons,\n                    // moneyOwing: student.moneyOwing,\n                    // moneyInAdvance: student.moneyInAdvance\n                });\n            }\n        }, 1000);\n    };\n\n\n    // lessonStatusChange = (lesson, newStatus) => {\n    //     lesson.status = newStatus;\n    //     this.props.updateLesson(lesson);\n    //     this.props.fetchAllLessonsForStudent(+this.props.match.params.id, this.props.lesson.currentPage, this.state.lessonsPerPage);\n    // }\n\n    settleChange = event => {\n\n        this.setState({\n            [event.target.name]: event.target.value,\n        });\n        this.setPriceOneH();\n        setTimeout(() => {\n            this.setPriceOneH();\n\n            this.countTotalPrice();\n        }, 100);\n\n    };\n\n    handleCheckboxCustomPriceChange = () => {\n        this.setState({\n            disableCustomPrice: !this.state.disableCustomPrice,\n            customPrice: ''\n        });\n\n        setTimeout(() => {\n            if (this.state.disableCustomPrice) {\n                this.setPriceOneH();\n                this.countTotalPrice();\n            }\n        }, 10);\n    }\n\n    handleCheckboxDiscountChange = () => {\n        this.setState({\n            disableDiscount: !this.state.disableDiscount,\n            discount: ''\n        });\n\n        setTimeout(() => {\n            if (this.state.disableDiscount) {\n                this.setPriceOneH();\n                this.countTotalPrice();\n            }\n        }, 10);\n    }\n\n    returnToStudentList = () => {\n        return this.props.history.push(\"/students\");\n    };\n\n    settleStudent = () => {\n        const studentLessons = this.props.lessons\n        for (let i = 0; i < studentLessons.length; ++i) {\n            if (studentLessons[i].status === 'Finished_Unpaid') {\n                const lesson = {\n                    id: studentLessons[i].id,\n                    instructor: studentLessons[i].instructor,\n                    student: studentLessons[i].student,\n                    date: studentLessons[i].date,\n                    time: studentLessons[i].time,\n                    howLong: studentLessons[i].howLong,\n                    nrStudents: studentLessons[i].nrStudents,\n                    status: \"Finished_Paid\"\n                };\n                //  console.log(lesson);\n                this.props.updateLesson(lesson);\n            }\n        }\n\n        if (this.state.totalPrice < 0) {\n            var newMoneyInAdvance = -this.state.totalPrice;\n            var newPaymentStatus = \"We_Owe\";\n        }\n        //let newStudentStatus = \"We_Owe\"\n        // Owes_Us\n        else {\n            var newMoneyInAdvance = 0;\n            var newPaymentStatus = \"Settled\"\n        }\n\n\n        const student = {\n            id: this.props.student.student.id,\n            lastName: this.props.student.student.lastName,\n            firstName: this.props.student.student.firstName,\n            idCardNr: this.props.student.student.idCardNr,\n            telNr: this.props.student.student.telNr,\n            paymentStatus: newPaymentStatus,\n            lessonHours: this.props.student.student.lessonHours,\n            unpaidLessons: this.props.student.student.unpaidLessons,\n            moneyOwing: this.props.student.student.moneyOwing,\n            moneyInAdvance: newMoneyInAdvance\n        };\n        // console.log(student);\n\n\n        this.props.updateStudent(student);\n\n        setTimeout(() => {\n\n            if (!this.props.student.error && !this.props.lesson.error) {\n                this.setState({ \"showSuccesMessage\": true });\n                setTimeout(() => this.setState({ \"showSuccessMessage\": false }), 3000);\n                setTimeout(() => this.returnToStudentList(), 1000);\n            } else {\n                this.setState({ \"showInvalidMessage\": true, \"method\": \"post\" });\n                setTimeout(() => this.setState({ \"showInvalidMessage\": false }), 3000);\n            }\n        }, 2000);\n    }\n\n    listButtonHandle = () => {\n        this.setState({\n            showLessonList: !this.state.showLessonList\n        });\n    }\n\n    render() {\n        const searchedLesson = this.props.lesson.searchedLesson;\n        const totalPages = this.props.lesson.totalPages;\n        const totalElements = this.props.lesson.totalElements;\n        const lesson = this.props.lesson;\n        const lessons = this.props.lessons;\n        const currentPage = this.props.lesson.currentPage;\n        const student = this.props.student.student;\n        const { moneyInAdvance, unpaidLessons, paymentStatus, lessonHours } = this.props.student.student;\n        const priceTables = this.props.priceTable.priceTables;\n        const { priceTable, priceOneH, discount, totalPrice, payForHowMany, howMany1p, howMany2p, howMany3p, customPrice } = this.state;\n\n        const pageNumCss = {\n            width: \"45px\",\n            border: \"1px solid #F8F8FF\",\n            color: \"#F8F8FF\",\n            textAlign: \"center\",\n            fontWeight: \"bold\"\n        };\n\n        const searchBoxCss = {\n            width: \"100px\",\n            border: \"1px solid #17A2B8\",\n            color: \"#17A2B8\",\n            textAlign: \"center\",\n            fontWeight: \"bold\"\n        };\n\n        return (\n            <div>\n                <div style={{ \"display\": this.state.show ? \"block\" : \"none\" }}>\n                    <SuccessToast show={this.state.show} message={\"Student Settled Successfully\"} type=\"success\" />\n                </div>\n\n                <StudentLessonsList showLessonList={this.state.showLessonList} student={student} lessons={lessons}\n                    onClose={this.listButtonHandle} />\n                {/* <div style={{ \"display\": this.state.showInvalidMessage ? \"block\" : \"none\" }}>\n                <SuccessToast show={this.state.showInvalidMessage} message={\"Invalid Data - might be in the data base already\"} type=\"dangerNoSuccess\" />\n            </div> */}\n\n                <Card className={\"border border-dark bg-dark text-white\"}>\n                    <Card.Header>\n                        <FontAwesomeIcon icon={faWallet} /> Settle Student\n                </Card.Header>\n                    <Form >\n                        <Card.Body>\n                            <div id=\"container\" style={{ \"clear\": \"both\", \"display\": \"flex\", \"justifyContent\": \"space-between\" }}>\n\n                                <div>\n                                    <h5>Student</h5>\n                                    <h4>{student.firstName + \" \" + student.lastName}</h4>\n\n                                    <h6>Full Nr of Lessons [h]</h6>\n                                    <h5>{lessonHours}</h5>\n\n                                    <h6>Nr of Unpaid Lessons [h] (1p/2p/+3p)</h6>\n                                    <h5>{unpaidLessons} ({howMany1p ? howMany1p : 0}/{howMany2p ? howMany2p : 0}/{howMany3p ? howMany3p : 0})</h5>\n\n                                    <h6>Money in advance [zl]</h6>\n                                    <h5>{moneyInAdvance}</h5>\n\n                                    <h5>Total price</h5>\n                                    <h4>{totalPrice ? totalPrice : 0} zl</h4>\n\n                                </div>\n                                <div>\n                                    <Form.Group as={Col} controlId=\"formGridPriceTables\">\n                                        <Form.Label>Offer</Form.Label>\n                                        <Form.Control\n                                            disabled={!this.state.disableCustomPrice}\n                                            required as=\"select\"\n                                            autoComplete=\"off\"\n                                            name=\"priceTable\"\n                                            value={priceTable}\n                                            onChange={this.settleChange}\n                                            className={\"bg-dark text-white\"} >\n                                            {this.state.disableCustomPrice ? priceTables.map(priceTable =>\n                                                <option key={priceTable.id} value={JSON.stringify(priceTable)}>\n                                                    {priceTable.name + \" \" + priceTable.minNrHours + \"h\"\n                                                    }\n                                                </option>\n                                            ) : \"\"}\n                                        </Form.Control>\n                                    </Form.Group>\n\n                                    <InputGroup className=\"mb-3\">\n                                        <InputGroup.Prepend >\n                                            <InputGroup.Checkbox onChange={() => this.handleCheckboxCustomPriceChange()} />\n                                        </InputGroup.Prepend>\n                                        <Form.Group as={Col} controlId=\"formGridCustomPrice\" name=\"customPrice\">\n                                            <Form.Label>Custom Price</Form.Label>\n                                            <Form.Control\n                                                disabled={this.state.disableCustomPrice}\n                                                autoComplete=\"off\"\n                                                type=\"test\"\n                                                name=\"customPrice\"\n                                                value={customPrice}\n                                                onChange={this.settleChange}\n                                                placeholder={this.state.disableCustomPrice ? \"\" : \"Enter Price [zl]\"}\n                                                className={\"bg-dark text-white\"} />\n                                        </Form.Group>\n                                    </InputGroup>\n\n                                    <InputGroup className=\"mb-3\">\n                                        <InputGroup.Prepend >\n                                            <InputGroup.Checkbox onChange={() => this.handleCheckboxDiscountChange()} />\n                                        </InputGroup.Prepend>\n                                        <Form.Group as={Col} controlId=\"formGridDiscount\" name=\"discount\">\n                                            <Form.Label>Discount [%]</Form.Label>\n                                            <Form.Control\n                                                disabled={this.state.disableDiscount}\n                                                autoComplete=\"off\"\n                                                type=\"test\"\n                                                name=\"discount\"\n                                                value={discount}\n                                                onChange={this.settleChange}\n                                                placeholder={this.state.disableDiscount ? \"\" : \"Enter Discount [%]\"}\n                                                className={\"bg-dark text-white\"} />\n                                        </Form.Group>\n                                    </InputGroup>\n\n\n                                </div>\n\n                            </div>\n\n                        </Card.Body>\n\n                        <Card.Footer>\n                            <div id=\"container\" style={{ \"clear\": \"both\", \"display\": \"flex\", \"justifyContent\": \"space-between\" }}>\n                                <div>\n                                    <Button size=\"sm\" variant=\"info\" onClick={() => this.settleStudent()}>\n                                        <FontAwesomeIcon icon={faMoneyCheckAlt} />  Settle\n                                </Button>\n                                    {'      '}\n\n\n\n                                    <Button size=\"sm\" variant=\"secondary\" type=\"reset\">\n                                        <FontAwesomeIcon icon={faUndo} />  Reset\n                                </Button>\n                                </div>\n                                <Button size=\"bg\" variant=\"light\" disabled={lessons.filter(lesson => lesson.status == \"Finished_Unpaid\").length ? false : true}\n                                    onClick={() => this.listButtonHandle()}>\n                                    <FontAwesomeIcon icon={faList} />  Unpaid Lessons\n                                </Button>\n                            </div>\n                                \n                            {'      '}\n                            <div>\n                                <Button size=\"sm\" variant=\"light\" type=\"button\" onClick={() => this.returnToStudentList()}>\n                                    <FontAwesomeIcon icon={faArrowLeft} />  Return\n                </Button>\n                            </div>\n                        </Card.Footer>\n                    </Form >\n\n\n                </Card >\n            </div>\n        );\n    }\n\n}\n\nconst mapStateToProps = state => {\n    return {\n        lessons: state.lesson.lessons,\n        lesson: state.lesson.lesson,\n        student: state.student,\n        priceTable: state.priceTable\n    }\n};\n\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        fetchAllLessonsForStudent: (studentId, currentPage, size) => dispatch(fetchAllLessonsForStudent(studentId, currentPage, size)),\n        deleteLesson: (lessonId) => dispatch(deleteLesson(lessonId)),\n        searchLessons: (searchedLesson, currentPage, sizePage) => dispatch(searchLessons(searchedLesson, currentPage, sizePage)),\n        updateLesson: (lesson) => dispatch(updateLesson(lesson)),\n        fetchStudent: (studentId) => dispatch(fetchStudent(studentId)),\n        fetchAllPriceTables: (firstElement) => dispatch(fetchAllPriceTables(firstElement)),\n        fetchPriceTableWithNrOfLessons: (fullNrOfLessons) => dispatch(fetchPriceTableWithNrOfLessons(fullNrOfLessons)),\n        updateStudent: (student) => dispatch(updateStudent(student))\n    }\n\n};\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)(StudentSettle);"]},"metadata":{},"sourceType":"module"}